Программа в режиме конкурентного доступа читает из и пишет в файл, содержащий записи фиксированного формата. Формат записей произвольный. Примерный формат записи:
struct record_s {
char name[80]; // Ф.И.О. студента
char address[80]; // адрес проживания
uint8_t semester;/ семестр
};
Файл должен содержать не менее 10 записей. Создается и наполняется с помощью любых средств.
Программа должна выполнять следующие операции:
1) LST ‒ Отображение содержимого файла с последовательной нумерацией записей
2) GET Rec_No ‒ получение записи с порядковым номером Rec_No;
3) Модификацию полей записи
4) PUT ‒ сохранение последней прочитанной и модифицированной записи по месту.
Интерфейс с пользователем на твой «вкус».
Алгоритм конкурентного доступ к записи
REC <-- get(Rec_No) // читаем запись в буфер REC
Again:
REC_WRK <-- REC // копируем в рабочую область
... // делаем что-нибудь с записью в REC_WRK и желаем ее сохранить
if (REC_WRK != REC) { 
lock(Rec_No) // блокируем запись для модификации в файле
REC_NEW <-- get(Rec_No) // и перечитываем запись из файла
if (REC_NEW != REC) { // кто-то изменил запись после получения ее нами
unlock(Rec_No) // освобождаем запись
message // сообщаем, что запись кто-то изменил
REC <-- REC_NEW // повторим все с ее новым содержимым если нужно
goto Again
}
put(REC_WRK, Rec_No) // сохраняем новое содержимое
unlock(Rec_No) // освобождаем запись
}
Для отладки и тестирования используется не менее двух экземпляров программы.
Для блокирования записей используется fcntl() и исключительные блокировки на основе файловых описаний ( FOFD*).
